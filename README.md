Steam Accounting Bookmarklet
============================

Steam Accounting Bookmarklet is a JavaScript that that sums up all your Steam purchases and compares them with all Steam wallet funds you once had. It also gives you a total overview about your spending within Steam. (Redeemed CD keys are only counted, not priced.)

What does it?
------
This JavaScript adds 3 accounts (in grey boxes): ingame, market and store.
ingame: You can see how much money you spent in in-game stores.
market: Lets you see how much you made by selling stuff and how much you spent. If your "Total Spent" is negative, you gained money. Otherwise you spend funds you bought in the shop."
store: Here you see how much money you spent on products in the store (Debit) and for adding funds to your wallet (Credit). The number of transactions also includes complimentary products. If your "Total Spent" amount is negative, you bought more Steam wallet funds than products in the store. You might have spent it in-game or on the market instead of store products. Or you still have it in your wallet. (This is the case if your balance is negative in the bluish grey box at the top.)

Above the accounts you see the total Steam balance from the original Steam Receipt Bookmarklet in the bluish grey box. If the "Total Spent" number is negative, it shows you the amount of money you have left in your Steam wallet. Furthermore this is the place where you can see how many CD Keys you redeemed.

Usage
-----
Simply create a new bookmark with the contents of the js file and put it between "javascript:(function(){" and "})();". When you're on your account page, click the bookmarklet to get a summary of your account spending at the top of the page.
	To do so:
[Click on this textlink an drag it to your bookmarks](javascript:(function(){if(location.href==="https://store.steampowered.com/account/"||location.href==="https://store.steampowered.com/account"){var steamReceipt={transactions:[],currencyList:[],currencyTotals:[],wallet:jQuery(".price")[0].innerHTML,transactionCount:0,cdkeyCount:0,credits:0};jQuery.each(["store","ingame","market"],function(e,t){var n={transactions:[],currencySum:[]};var r={transactions:[],currencySum:[]};jQuery(steamReceipt.currencyList).each(function(){n.currencySum[this]=0;r.currencySum[this]=0});jQuery("#"+t+"_transactions .transactionRow").each(function(){var e={date:jQuery(this).find(".transactionRowDate").text(),currency:jQuery(this).find(".transactionRowPrice").text().replace(/[\w\s-.,]/g,""),price:Number(jQuery(this).find(".transactionRowPrice").text().replace(/[^\d.,-]/g,"").replace(",",".").replace(/-/g,"0").split(".").splice(0,2).join(".")),event:jQuery(this).find(".transactionRowEvent").text(),description:jQuery(this).find(".transactionRowEvent .transactionRowTitle").text(),descriptionSub:jQuery(this).find(".transactionRowEvent .itemSubtext").text()};if(e.currency.toString()==="уб"){e.currency="pуб"}var t=e.currency.toString();if(jQuery.inArray(e.currency,steamReceipt.currencyList)===-1&&e.currency){steamReceipt.currencyList.push(t);steamReceipt.currencyTotals[t]=0;n.currencySum[t]=0;r.currencySum[t]=0}if(jQuery(this).find(".transactionRowEvent").hasClass("walletcredit")){if(e.currency){r.currencySum[t]+=e.price;steamReceipt.currencyTotals[t]-=e.price}r.transactions.push(e);steamReceipt.credits+=1;e.price*=-1;steamReceipt.transactionCount+=1;steamReceipt.transactions.push(e)}else if(jQuery(this).find(".transactionRowEvent").hasClass("charge")){if(e.currency){n.currencySum[t]+=e.price;steamReceipt.currencyTotals[t]+=e.price}n.transactions.push(e);steamReceipt.transactionCount+=1;steamReceipt.transactions.push(e)}if(jQuery(this).find(".transactionRowEvent").hasClass("cdkey")){steamReceipt.cdkeyCount+=1;steamReceipt.transactionCount+=1;steamReceipt.transactions.push(e)}});jQuery("#sr"+t).remove();jQuery(".page_title_area").after('<div id="sr'+t+'" style="width:100%;margin:1em 0px;padding: 1em;background-color:#262626;color:#b0aeac"><p style="width:50%;float:left;">You\'ve made '+(n.transactions.length+r.transactions.length)+" "+t+" transactions on Steam .<br/><br/>Your Steam wallet was debited by "+n.transactions.length+" transactions.<br/>Funds were added to your Steam wallet by "+r.transactions.length+' transactions.<br/><br/>The total amount spent on the transactions (within Steam) can be seen to the right. Debit means: money were spent from your Steam wallet. Credit: funds got added to your Steam wallet.</p><table id="steam_'+t+'_account_table" style="width:50%;float:right;border-width:0;border-collapse:collapse;"><tbody><tr><th colspan="2" style="border-bottom: 2px solid #b0aeac;">'+t+' transactions</th></tr><tr style="border-bottom: 1px solid #b0aeac;}"><th style="border-right:2px solid #b0aeac;width:50%">Debit</th><th style="width:50%">Credits</th></tr></tbody></table><hr style="clear:right"/><p style="margin-top:1em"><strong>Total Spent:</strong> <span id="srTotal'+t+'" style="padding-left:1em"></span><br/><small>(if negative, the funds gained in this account exceed your spending)</small></p><p style="clear:both;padding-top:.4em;font-size:.8em;">Steam Accounting (based on Steam Receipt, see above) Readme and the Source Code can be found at <a href="https://github.com/hihain/steam-receipt-bookmarklet">GitHub</a>.</p></div>');jQuery(steamReceipt.currencyList).each(function(){jQuery("#steam_"+t+"_account_table tbody").append('<tr><td class="sg_col2" style="text-align: left;border-right: 2px solid #b0aeac;">'+this+Math.round(n.currencySum[this]*100)/100+'</td><td class="sg_col2">'+this+Math.round(r.currencySum[this]*100)/100+"</td></tr>");jQuery("#srTotal"+t+"").append(this+Math.round((n.currencySum[this]-r.currencySum[this])*100)/100+" / ")})});jQuery("#steam_gauge_wrapper").remove();jQuery(".page_title_area").after('<div id="steam_gauge_wrapper"><p id="steam_gauge_receipt">You\'ve made '+steamReceipt.transactionCount+" transactions on Steam.<br/><br/>"+steamReceipt.cdkeyCount+" of those are product redemptions on Steam for external purchases (aka CD keys, so Steam doesn't know how much you paid).<br/><br/>"+steamReceipt.credits+" of those transactions added funds to your Steam wallet.<br/><br/>The total amount spent on your Steam account (within Steam) can be seen to the right. These totals include store purchases, wallet funding, gift purchases, in-game purchases, and market purchases.<br/><br/>Your Steam wallet currently contains "+steamReceipt.wallet+'</p><table id="steam_gauge_receipt_table"><tbody><tr style="border-bottom: 1px solid #ddd;}"><th style="text-align:right;padding-right:.5em">Currency</th><th style="text-align:left;padding-left:0.5em;">Total Spent <small>(negative values are credits)</small></th></tr></tbody></table><hr style="width:100%;margin:1em auto;clear:both;"><p style="display:block;width:100%;clear:both;text-align:center;font-weight:bold;">Steam Receipt was developed by <a href="http://www.mysteamgauge.com" style="text-decoration:underline;">Steam Gauge</a> <small>(with some improvements by <a href="https://github.com/hihain/steam-receipt-bookmarklet" style="text-decoration:underline;">hihain</a>)</small> and is in no way affiliated with Valve.</p></div>');jQuery(steamReceipt.currencyList).each(function(){jQuery("#steam_gauge_receipt_table tbody").append('<tr><td class="sg_col1">'+this+'</td><td class="sg_col2">'+Math.round(steamReceipt.currencyTotals[this]*100)/100+"</td></tr>")});jQuery("head").append('<style type="text/css">#steam_gauge_wrapper{width:100%;margin:1em 0px;padding: 1em;background-color:slategray;}#steam_gauge_receipt{width:50%;float:left;}#steam_gauge_receipt_table{width:50%;float:right;border-width: 0px !important;border-collapse: collapse !important;}.sg_col1{text-align:right;}.sg_col2{text-align:left;padding-left: 0.5em;}.youraccount_tabs{clear:both;}</style>')}else{alert("This script only works at:\n\nhttps://store.steampowered.com/account/")}})();)

Limitations/Known Issues
------------------------
Steam does track key redemptions (from game bundles, retail purchase, etc), but has no way of knowing how much you paid for it, so those costs are excluded.
I just do not know what happens if you use a voucher for adding Steam funds. Perhaps you won't see the funds adding to your balance... Let me know!

Authors
------
Jonathan Prusik @jprusik [www.classynemesis.com](http://www.classynemesis.com)
Hauke Hain